<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>طلبات المعاملات القنصلية</title>
  <!-- The rest of the head section remains unchanged -->
</head>
<body>
  <h2>طلبات المعاملات القنصلية</h2>

  <!-- Existing auth section -->

  <div id="app-section">
    <!-- Updated dropdown for transaction types -->
    <select id="transaction-type">
      <option value="شهادة ميلاد">شهادة ميلاد</option>
      <option value="بطاقة الرقم القومى">بطاقة الرقم القومى</option>
      <option value="صحيفة الحالة الجنائية">صحيفة الحالة الجنائية</option>
      <option value="قيد فردى">قيد فردى</option>
      <option value="قيد عائلى">قيد عائلى</option>
      <option value="شهادة طلاق">شهادة طلاق</option>
      <option value="شهادة زواج">شهادة زواج</option>
      <option value="شهادة وفاة">شهادة وفاة</option>
      <option value="إفادة">إفادة</option>
      <option value="إصدار جواز سفر لأول مرة">إصدار جواز سفر لأول مرة</option>
      <option value="تجديد جواز سفر">تجديد جواز سفر</option>
      <option value="بحث الجنسية">بحث الجنسية</option>
      <option value="إسترداد الجنسية">إسترداد الجنسية</option>
      <option value="الإذن بالتجنس مع الاحتفاظ بالجنسية المصرية">الإذن بالتجنس مع الاحتفاظ بالجنسية المصرية</option>
      <option value="الإذن بالتجنس مع عدم الاحتفاظ بالجنسية المصرية">الإذن بالتجنس مع عدم الاحتفاظ بالجنسية المصرية</option>
    </select>

    <!-- New phone and email fields, not stored -->
    <label>رقم الهاتف:</label>
    <input type="tel" id="phone" />
    <label>البريد الإلكتروني:</label>
    <input type="email" id="user-email" />

    <!-- Updated status dropdown -->
    <select id="status-select">
      <option value="وردت المعاملة. رجاء إحضار الايصال ومستند الهوية والحضور للاستلام خلال المواعيد الرسمية المعلنة.">
        وردت المعاملة. رجاء إحضار الايصال ومستند الهوية والحضور للاستلام خلال المواعيد الرسمية المعلنة.
      </option>
      <option value="مطلوب استيفاء">مطلوب استيفاء</option>
      <option value="جارى مراجعة الطلب">جارى مراجعة الطلب</option>
      <option value="تم الإرسال بالبريد">تم الإرسال بالبريد</option>
    </select>

    <!-- Removed deletion controls -->
    <!-- Removed delete-one-btn and delete-all-btn sections -->

    <!-- In the PDF generation logic inside the submit button click handler, include name, phone, email -->
    const phone = document.getElementById('phone').value.trim();
    const userEmail = document.getElementById('user-email').value.trim();
    
    const resultHTML = `
      نوع المعاملة -  ${transaction}<br>
      اسم مقدم الطلب -  ${name}<br>
      رقم الهاتف -  ${phone}<br>
      البريد الإلكتروني -  ${userEmail}<br>
      رقم الطلب <span style="cursor:pointer; color:blue; text-decoration:underline" onclick="document.getElementById('existing-number').value='${data.number}'">${data.number}</span><br>
      الحالة  - ${data.status}<br>
      الملاحظات  - ${data.notes || "لا توجد"}<br>
      التاريخ  ${dateOnly}<br><br>
      <strong>لمتابعة موقف الطلب يرجى التحقق برقم الطلب المكون من خمسة أعداد باللغة الانجليزية فى القسم المخصص على موقع البعثة</strong><br>
      <canvas id="qr-canvas" class="qr-img"></canvas>
      <div class="ltr-link">https://www.egyptconsulate-frankfurt.de/</div>
    `;

    // Also update the database insertion status string to "جارى مراجعة الطلب"
    const { error: insertError } = await supabase.from('civil_status').insert({ number, status: "جارى مراجعة الطلب", notes });
  </script>
</body>
</html>
